###########################################
#                                         #
#      Signal Separation with MEKD        #
#                                         #
#         author: Matt Snowball           #
#        last update: 06.05.2013          #
#                                         #
###########################################


1) Build CMSSW

	$ cmsrel CMSSW_6_1_1
	$ cd CMSSW_6_1_1/src
	$ cvs co -r V03-01-00 HiggsAnalysis/CombinedLimit
	$ scram b -j12

2) copy needed scripts

	$ cp <path to HZZ4L_Combination/CombinationPy>/SignalSeparation/MEKD/* ./

3) copy cards for signal separation

	$ mkdir HCG_<model>
	$ cp -r <path to cards>/cards_7TeV/HCG/<mass>/* HCG_<model>
	$ cp -r <path to cards>/cards_8TeV/HCG/<mass>/* HCG_<model>

4a) validate cards

	$ cp utlities/validateJCPcards.py .
	$ python validateJCPcards.py -b -i HCG_<model> -x <xkdname=CMS_zz4l_smd> -y <ykdname>

This will create a validation directory in the HCG_<model> directory with plots of slices and templates with their
binning as well as printing out bin areas, normalizations, and expected event counts. 2D pdfs will not be normalized 
to 1 with variable binning due to RooFit issues.  This is OK. To move on to 4b successfully, you must move or delete 
the validation directory out of the HCG_<model> directory.


4b) check python script for options

	Usage: runJCPModels.py [options] datasetList
	runJCPModels.py -h for help
	
	Options:
	  -h, --help            show this help message and exit
	  -b                    no X11 windows
	  --fitNuis             fit nuissances (default=False)
	  --generateToys        generate toys
	  --haddToys            hadd toys only
	  --plot                hadd toys and make plot
	  --replot              dont hadd toys, make plot
	  --tool=TOOL           Tool: combine or lands
	  -t NTOYS, --toys=NTOYS
	                        Number of total toys, will be paralelised to have 20K
	                        per job
	  -d SOURCEDIR, --dir=SOURCEDIR
	                        SOURCEDIR, skip if SOURCEDIR is empty
	  -n DIRNAME, --name=DIRNAME
	                        submission dir names - submission_$i
	  -M MODEL, --model=MODEL
	                        model name
	  -m MASS, --mh=MASS    mass of Higgs hypothesis
	  -e ENERGY, --sqrts=ENERGY
	                        sqrts: 7, 8, 7p8
	  -u MUTYPE, --mu=MUTYPE
	                        type of mu: fixed or float[default]
	

5) to run toys do the following

	$ python runJCPModels.py --generateToys -t <total toys> -d HCG_<model> -M <model name> -m <mass> --mu=<fixed or float>

this will create a directory named after your model (-M) and within it will be a number of submission_<i> directories, each which will run 20K toys (about 1hr worth of batch).  These will be submitted to LSF 8nh queue.

6) when the toys are done, you can either manually hadd toys together, or you can hadd toys and plot in one step 

	-To hadd toys only
	$ python runJCPModels.py -b --haddToys -M <model> --fitNuis=<fixed or float> -m <mass>

	-To hadd toys and plot
	$ python runJCPModels.py -b --plot -M <model> --fitNuis=<fixed or float> -m <mass>

All results will be kept in the <model> directory

